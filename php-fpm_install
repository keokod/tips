sudo apt-get update && sudo apt-get -y upgrade
sudo apt-get install ufw
sudo ufw enable # Firewall is active and enabled on system startup
sudo ufw allow from 192.168.1.8 #rule added
sudo nano /etc/hostname # donner un nom à votre serveur ex:mail.exemple.com
sudo nano /etc/hosts # ajouter à la première ligne votre nom ex : 127.0.0.1 mail.exemple.com
sudo apt-get install --assume-yes ssl-cert
sudo make-ssl-cert generate-default-snakeoil --force-overwrite
sudo apt-get upgrade --assume-yes
sudo nano /etc/apt/sources.list # ajouter cette liste => deb http://packages.dotdeb.org jessie all
#obligatoire se connecter en root
wget -O- https://www.dotdeb.org/dotdeb.gpg | apt-key add - apt-update #100%[==============>]   5,17K  --.-KB/s   ds 0s 
exit
sudo apt install php7.0 php7.0-fpm php7.0-mysql php7.0-curl php7.0-json php7.0-gd php7.0-mcrypt php7.0-msgpack php7.0-memcached php7.0-intl php7.0-sqlite3 php7.0-gmp php7.0-geoip php7.0-mbstring php7.0-xml php7.0-zip
sudo apt-get install apache2
 ____________________________________________________________
config apache2
cat /etc/apache2/sites-available/php.conf 
<VirtualHost *:80>
	ServerName php.test.local
	DocumentRoot /var/www/php

  ProxyPassMatch ^/(.*\.php)$ fcgi://127.0.0.1:9000/var/www/php/$1

  <Directory /var/www/php/>
	Options Indexes FollowSymLinks MultiViews
	AllowOverride None
	Require all granted
  </Directory>
	ErrorLog ${APACHE_LOG_DIR}/error_php.log
	CustomLog ${APACHE_LOG_DIR}/access_php.log combined
</VirtualHost>


apt-get install php5-fpm apache2-mpm-worker
a2enmod proxyAfin de pouvoir installer le module FastCGI de Apache, qui nous sera nécessaire pour faire fonctionner PHP-FPM, il nous faut d’abord activer les dépôts contrib et non-free dans le ficher /etc/apt/sources.list :

deb http://security.debian.org/ jessie/updates main contrib non-free deb http://debian.mirrors.ovh.net/debian/ jessie-updates main contrib non-free deb http://debian.mirrors.ovh.net/debian/ jessie main contrib non-free
a2enmod proxy_fcgi
a2enconf php
a2dismod php5 mpm_prefork
a2enmod mpm_worker
sudo service apache2 restart
# Vérification du mode Worker
apache2ctl -V
Server version: Apache/2.4.7 (Ubuntu)
Server built:   Mar 10 2015 13:05:59
Server's Module Magic Number: 20120211:27
Server loaded:  APR 1.5.1-dev, APR-UTIL 1.5.3
Compiled using: APR 1.5.1-dev, APR-UTIL 1.5.3
Architecture:   64-bit
Server MPM:     worker



Il faut paramétrer le pool php-fpm par défaut : /etc/php5/fpm/pool.d/www.conf Modifier le fichier avec les informations concernant le listen:

;listen = /var/run/php5-fpm.sock
listen = 127.0.0.1:9000
listen.allowed_clients = 127.0.0.1
-----------------------------------------------------------------------------------------------------------------


sudo apt-get install openssl ssl-cert 


---------------Résoudre l’erreur de FQDN¶

Si on regarde les logs de Apache (journalctl -u apache2 -e), on a déjà une erreur :

apache2: Could not reliably determine the server's fully qualified domain name, using 127.0.0.1 for ServerName

Elle n’est pas problématique dans le sens où elle n’empêche le processus de démarrer correctement. Cependant on va tout de même tâcher de s’en débarrasser pour éviter de polluer les logs.

On créer donc un fichier /etc/apache2/conf-available/fqdn.conf dans lequel on va mettre :

ServerName localhost

On peut éventuellement remplacer localhost par le nom du serveur, srv.example.net.

Ensuite on active notre fichier de configuration et on recharge le service :

a2enconf fqdn systemctl reload apache2--------------------------------------------


